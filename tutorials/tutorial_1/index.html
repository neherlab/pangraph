<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Building a pangraph · PanGraph.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PanGraph.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorial</span><ul><li class="is-active"><a class="tocitem" href>Building a pangraph</a><ul class="internal"><li><a class="tocitem" href="#Requirements"><span>Requirements</span></a></li><li><a class="tocitem" href="#Building-the-pangraph"><span>Building the pangraph</span></a></li><li><a class="tocitem" href="#Exporting-the-pangraph"><span>Exporting the pangraph</span></a></li></ul></li><li><a class="tocitem" href="../tutorial_2/">The structure of Pangraph output file</a></li><li><a class="tocitem" href="../tutorial_3/">Polishing the pangraph and exploring alignments</a></li><li><a class="tocitem" href="../tutorial_4/">Projecting the graph on a subset of strains.</a></li><li><a class="tocitem" href="../tutorial_5/">Example application: plasmid rearrangements</a></li><li><a class="tocitem" href="../tutorial_6/">Example application: antibiotic resistance gene neighbourhoods</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../lib/pangraph/">PanGraph globals</a></li><li><a class="tocitem" href="../../lib/align/">Alignment</a></li><li><a class="tocitem" href="../../lib/block/">Blocks</a></li><li><a class="tocitem" href="../../lib/edge/">Edges</a></li><li><a class="tocitem" href="../../lib/graph/">Graphs</a></li><li><a class="tocitem" href="../../lib/gfa/">GFA</a></li><li><a class="tocitem" href="../../lib/mash/">Mash Implementation</a></li><li><a class="tocitem" href="../../lib/minimap/">Minimap2 Wrapper</a></li><li><a class="tocitem" href="../../lib/mmseqs/">MMseqs Wrapper</a></li><li><a class="tocitem" href="../../lib/node/">Nodes</a></li><li><a class="tocitem" href="../../lib/path/">Paths</a></li><li><a class="tocitem" href="../../lib/simulate/">Simulation</a></li><li><a class="tocitem" href="../../lib/utility/">Utility</a></li></ul></li><li><span class="tocitem">Command Line</span><ul><li><a class="tocitem" href="../../cli/build/">Build</a></li><li><a class="tocitem" href="../../cli/export/">Export</a></li><li><a class="tocitem" href="../../cli/generate/">Generate</a></li><li><a class="tocitem" href="../../cli/marginalize/">Marginalize</a></li><li><a class="tocitem" href="../../cli/polish/">Polish</a></li><li><a class="tocitem" href="../../cli/version/">Version</a></li></ul></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../../dev/building-docker/">Building Docker image</a></li><li><a class="tocitem" href="../../dev/building-documentation/">Updating the documentation</a></li><li><a class="tocitem" href="../../dev/releasing/">Releasing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Building a pangraph</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Building a pangraph</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/neherlab/pangraph/blob/master/docs/src/tutorials/tutorial_1.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Building-a-pangraph"><a class="docs-heading-anchor" href="#Building-a-pangraph">Building a pangraph</a><a id="Building-a-pangraph-1"></a><a class="docs-heading-anchor-permalink" href="#Building-a-pangraph" title="Permalink"></a></h1><p>This short tutorial will walk you through the process of generating a pangraph from a set of bacterial genomes. We will also cover how to export the generated pangraph file into other formats.</p><p>Simply put, a <strong>pangenome graph</strong> (or <em>pangraph</em> for short) is a compressed representation of a set of genomes, in which alignable regions are saved as <em>blocks</em> (or <em>pancontigs</em>) and genomes are represented as <em>paths</em>, i.e. list of blocks.</p><p><img src="../../assets/pangraph_scheme.png" alt="img"/></p><h2 id="Requirements"><a class="docs-heading-anchor" href="#Requirements">Requirements</a><a id="Requirements-1"></a><a class="docs-heading-anchor-permalink" href="#Requirements" title="Permalink"></a></h2><p>The tutorial requires you to have the <code>pangraph</code> command available in your path. Instructions on how to install pangraph can be found in <a href="../../#Installation">Installation</a>.</p><p>For this tutorial we will use a small dataset containing full chromosomes of 10 <em>Escherichia Coli</em> strains (source: GenBank). For convenience this dataset is available in the pangraph repository (<code>example_dataset/ecoli.fa.gz</code>), and can be downloaded with the command:</p><pre><code class="language-bash hljs">wget https://github.com/neherlab/pangraph/raw/master/example_datasets/ecoli.fa.gz</code></pre><p>This is a single fasta file containing 10 fully assembled bacterial chromosomes, but no plasmids. Note that it is not necessary for all of the data to be packed in a single fasta file. One can also pass multiple fasta files (optionally gzipped) as input to the command to build a pangraph.</p><h2 id="Building-the-pangraph"><a class="docs-heading-anchor" href="#Building-the-pangraph">Building the pangraph</a><a id="Building-the-pangraph-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-pangraph" title="Permalink"></a></h2><p>As a first step, we will build a pangraph object from the DNA of the 10 chromosomes. This can be done using the command <code>build</code> (see <a href="../../cli/build/#Build">Build</a>):</p><pre><code class="language-bash hljs">pangraph build --circular ecoli.fa.gz &gt; ecoli_pangraph.json</code></pre><p>The option <code>--circular</code> is used when passing circular DNA sequences, like the bacterial chromosomes that we consider here.</p><p>On a consumer laptop the command should complete in around 10 minutes on 4 cores.</p><div class="admonition is-info"><header class="admonition-header">multi-threaded execution</header><div class="admonition-body"><p>All pangraph commands are immediately parallelizable by setting the environment variable <code>JULIA_NUM_THREADS</code> <em>before</em> running the build command. For example, to use 4 cores during the build command:</p><pre><code class="language-bash hljs">export JULIA_NUM_THREADS=4</code></pre></div></div><p>The result is a <code>ecoli_pangraph.json</code> file that contains two main entries: <code>paths</code> and <code>blocks</code>. As represented in the image above, blocks contain information on the nucleotide sequence, while paths are compressed representation for genomes as lists of blocks. The <code>pangraph.json</code> contains all information in the input genomes, which can be reconstructed from the graph without loss.</p><p>Below is a simplified view of the structure of the <code>ecoli_pangraph.json</code> file.</p><pre><code class="language-json hljs">{
    &quot;paths&quot;: [
        {
            &quot;name&quot;: &quot;NZ_CP010242&quot;,
            &quot;blocks&quot;: [ { &quot;id&quot;: &quot;NFTNKNMFIC&quot;, ... }, { &quot;id&quot;: &quot;YTLSRRNNGL&quot;, ... }, ... ],
            ...
        },
        {
            &quot;name&quot;: &quot;NC_009800&quot;,
            &quot;blocks&quot;: [  { &quot;id&quot;: &quot;AYYUXVXZXB&quot;, ... },  { &quot;id&quot;: &quot;YTLSRRNNGL&quot;, ... }, ... ],
            ...
        }
        ...
    ],
    &quot;blocks&quot;: [
        { &quot;id&quot;: &quot;KZJIDOXBAV&quot;, &quot;sequence&quot;: &quot;AAGGTGGGTAATCATTTTGATAAGTGAT...&quot;, ... },
        { &quot;id&quot;: &quot;UOFDTEUSWC&quot;, &quot;sequence&quot;: &quot;GTTTTAATGCCAGCAAAAATGGTGAATT...&quot;, ... },
        ...
    ]
}</code></pre><p>Each entry in <code>path</code> has two main properties: the <code>name</code>, corresponding to the sequence identifier in the input fasta file, and the <code>blocks</code> list. The latter is a representation of the genome as a list of blocks, each one identified by its unique <code>id</code>.</p><p>Each entry in the <code>blocks</code> lists corresponds to a different block. Each block is assigned an unique random id composed of 10 capital letters and the consensus <code>sequence</code> of the block.</p><p>More details on the structure of this <code>json</code> file will be covered in the next tutorial section.</p><h3 id="Sequence-diversity-and-alignment-sensitivity"><a class="docs-heading-anchor" href="#Sequence-diversity-and-alignment-sensitivity">Sequence diversity and alignment sensitivity</a><a id="Sequence-diversity-and-alignment-sensitivity-1"></a><a class="docs-heading-anchor-permalink" href="#Sequence-diversity-and-alignment-sensitivity" title="Permalink"></a></h3><p>As discussed in our <a href="https://neherlab.github.io/pangraph/#Citing-PanGraph">paper</a>, two variables control the maximum diversity of homologous sequences that are merged in the same block: the <strong>sensitivity of the alignment kernel</strong> and the <strong>values of the pseudo-energy hyperparameters</strong> <span>$\alpha$</span> and <span>$\beta$</span>.</p><p>Pangraph can be run with two options for the alignment kernel:</p><ul><li><code>-k minimap2</code>: uses the default minimap2 alignment kernel, with <em>asm10</em> option. This kernel find matches between sequences with up to 10% divergence. Sensitivity can be increased to 20% adding the option <code>-s 20</code>, which runs minimap with the <em>asm20</em> option. </li><li><code>-k mmseqs</code>: uses <a href="https://github.com/soedinglab/MMseqs2">mmseqs2</a> as alignment kernel. This is able to find matches on sequences with up to around 30% sequence divergence, at the cost of higher computational time.</li></ul><p>Moreover, as explained in our <a href="https://neherlab.github.io/pangraph/#Citing-PanGraph">paper</a> only matches with negative pseudo-energy are performed. The value of the pseudo-energy depends on two parameters:</p><ul><li>Parameter <span>$\alpha$</span> (command line option <code>-a</code>) controls the cost of splitting a block into smaller units. Decreasing this costs results on average in a more fragmented graph, but with &quot;deeper&quot; alignments that contain more sequences.</li><li>Parameter <span>$\beta$</span> (command line option <code>-b</code>) controls the diversity cost. This is the cost associated to aligning sequences that are highly diverged. In particular, matches in which the pairwise diversity <span>$d &gt; 1 /\beta$</span> are discarded. Decreasing this cost allows merging of more diverged sequences. The default value <span>$\beta=10$</span> sets a default sequence diversity threshold of 10%.</li></ul><p>Therefore, <strong>as a rule of thumb</strong>:</p><ul><li>if the average pairwise diversity of homologous sequences in your sample is below 5%, running pangraph with option <code>-k minimap2 -s 20 -b 5</code> will results in most merges performed correctly.</li><li>above this threshold, it is advised to use mmseqs2 as an alignment kernel, and optionally decreasing further the values of the energy hyperparameters <code>-k mmseqs -a 0 -b 0</code>.</li></ul><p>Note that, depending on the kmer size (<code>-K</code> argument) mmseqs2 can require several Gb of available memory to run.</p><h2 id="Exporting-the-pangraph"><a class="docs-heading-anchor" href="#Exporting-the-pangraph">Exporting the pangraph</a><a id="Exporting-the-pangraph-1"></a><a class="docs-heading-anchor-permalink" href="#Exporting-the-pangraph" title="Permalink"></a></h2><p>The pangraph object can also be exported in other more common formats using the command <code>export</code> (see <a href="../../cli/export/#Export">Export</a>).</p><pre><code class="language-bash hljs">pangraph export \
    --no-duplications \
    --output-directory ecoli_export \
    ecoli_pangraph.json</code></pre><p>This will create a folder named <code>ecoli_export</code> that contains two files.</p><ul><li><code>pangraph.fa</code>: a fasta file containing the consensus sequence for each block.</li><li><code>pangraph.gfa</code>: a <a href="https://github.com/GFA-spec/GFA-spec">Graphical Fragment Assembly</a> file that contains a representation of the pangenome graph structure.</li></ul><p>The latter can be visualized using <a href="https://rrwick.github.io/Bandage/">Bandage</a>. The option <code>--no-duplications</code> causes the export function to avoid including duplicated blocks in the graph representation (they are instead exported as isolated blocks). In our experience this results in a less &quot;tangled&quot; visual representation. Below is how the Bandage visualization of this example pangraph looks like. Blocks are colored by frequency, with common blocks (appearing in many different chromosomes) in red and rare blocks (appearing in only a few chromosomes) in black.</p><p><img src="../../assets/bandage_ecoli_full.png" alt="img"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../tutorial_2/">The structure of Pangraph output file »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Thursday 24 August 2023 08:34">Thursday 24 August 2023</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
